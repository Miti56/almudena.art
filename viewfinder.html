<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Almudena â€” Fullscreen Camera</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" />
    <link rel="stylesheet" href="viewfinder.css" />
</head>

<body>
<!-- Fuji camera body container -->
<div class="camera-shell">
    <img src="models/XM5-black-final-PS6.png" alt="Fuji Camera Back" class="camera-body" />
    <!-- Placeholder round buttons -->
    <div class="camera-buttons">
        <img src="UI/button1.png" alt="Weird Button" class="cam-btn btn-weird" />
        <img src="UI/button2.png" alt="Top Button" class="cam-btn btn-top" />
        <img src="UI/button3.png" alt="Middle Button" class="cam-btn btn-middle" />
        <img src="UI/button4.png" alt="Bottom Button" class="cam-btn btn-bottom" />
    </div>

    <div class="screen-area">
        <div class="ratio_16x9">
            <!-- ðŸ–¥ï¸ This is the part weâ€™ll replace -->
            <div class="screen-content">
                <video autoplay muted loop id="bg-video">
                    <source src="videoTest.mp4" type="video/mp4" />
                </video>
                <canvas id="video-effect-canvas"></canvas>
            </div>

            <!-- ðŸ§© These overlays stay ABOVE all content -->
            <div class="overlay scratches"></div>
            <div class="overlay dust"></div>
            <div class="overlay reflections"></div>


            <!-- Loading screen -->
            <div class="loading-screen">
                <div class="loading-text">Initializing Camera...</div>
            </div>

            <!-- HUD -->
            <div class="rec"><div class="content">Rec <b>&#x2022;</b></div></div>
            <div class="bat"><div class="content"><i class="fas fa-battery-full"></i></div></div>
            <div class="wifi"><div class="content"><i class="fas fa-wifi"></i></div></div>

            <div class="mode"><div class="content">Shooting: A</div></div>
            <div class="focus"><div class="content">AF-S</div></div>
            <div class="drive"><div class="content">DRIVE: 1/3</div></div>

            <div class="settings">
                <div class="shutter">1/125</div>
                <div class="aperture">f/2.8</div>
                <div class="iso">ISO 400</div>
            </div>

            <div class="format"><div class="content">RAW+JPG</div></div>

            <div class="focus-grid"><div class="grid-lines"></div></div>

            <div class="histogram"><canvas id="histogram" width="200" height="80"></canvas></div>



        </div>
    </div>
</div>

<script>
    const loadingScreen = document.querySelector('.loading-screen');
    const video = document.getElementById('bg-video');
    const histCanvas = document.getElementById('histogram');
    const histCtx = histCanvas.getContext('2d');
    const hiddenCanvas = document.createElement('canvas');
    const hiddenCtx = hiddenCanvas.getContext('2d');

    // Fade-in after 3s and start video/histogram
    setTimeout(() => {
        loadingScreen.style.transition = 'opacity 0.5s';
        loadingScreen.style.opacity = 0;
        setTimeout(() => loadingScreen.style.display = 'none', 500);
        video.play();
        updateHistogram();
    }, 3000);

    function updateHistogram() {
        if (video.readyState >= 2) {
            hiddenCanvas.width = video.videoWidth;
            hiddenCanvas.height = video.videoHeight;
            hiddenCtx.drawImage(video, 0, 0, hiddenCanvas.width, hiddenCanvas.height);
            const frame = hiddenCtx.getImageData(0, 0, hiddenCanvas.width, hiddenCanvas.height);
            const data = frame.data;
            const bins = 64;
            const histogram = new Array(bins).fill(0);

            for (let i = 0; i < data.length; i += 4) {
                const brightness = 0.2126 * data[i] + 0.7152 * data[i + 1] + 0.0722 * data[i + 2];
                histogram[Math.min(bins - 1, Math.floor((brightness / 256) * bins))]++;
            }

            const maxVal = Math.max(...histogram) * 1.05;
            histCtx.clearRect(0, 0, histCanvas.width, histCanvas.height);
            for (let i = 0; i < bins; i++) {
                const h = Math.sqrt(histogram[i] / maxVal) * histCanvas.height;
                histCtx.fillStyle = 'lime';
                histCtx.fillRect(i * (histCanvas.width / bins), histCanvas.height - h, histCanvas.width / bins, h);
            }
        }
        requestAnimationFrame(updateHistogram);
    }

    const screenArea = document.querySelector('.screen-content');

    function loadMenu(file) {
        fetch(file)
            .then(response => response.text())
            .then(html => {
                screenArea.innerHTML = html;
            })
            .catch(err => console.error('Error loading menu:', err));
    }

    // Map buttons to their menu files
    document.querySelector('.btn-weird').addEventListener('click', () => loadMenu('viewfinder.html'));
    document.querySelector('.btn-top').addEventListener('click', () => loadMenu('menus/menu2.html'));
    document.querySelector('.btn-middle').addEventListener('click', () => loadMenu('menus/menu3.html'));
    document.querySelector('.btn-bottom').addEventListener('click', () => loadMenu('menus/menu4.html'));

</script>
</body>
</html>
